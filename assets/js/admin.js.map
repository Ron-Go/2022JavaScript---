{"version":3,"file":"admin.js","names":["data","orderPageSection","document","querySelector","orderPageTable","orderStatus","discardAllBtn","addEventListener","e","preventDefault","target","tagName","dataset","id","paid","putData","changeOrder","value","deleteOrder","textContent","deleteAllOrder","renderOrder","orders","thead","tbody","forEach","item","user","products","createdAt","name","tel","address","email","takeoutOrderItem","convertDate","length","innerHTML","code","time","Date","months","split","weekdays","getFullYear","getMonth","getDate","getDay","titleStr","title","quantity","createChartData","saleItem","chartData","color","otherAcc","undefined","Object","keys","ary","push","sort","a","b","index","splice","chartTitle","renderC3","c3Data","chart","c3","generate","bindto","type","columns","colors","donut","api","apiPath","token","obj","axios","put","then","res","jumpAlert","err","console","log","message","defaults","headers","common","get","getOrders"],"sources":["admin.js"],"sourcesContent":["let data;\n\n\n/*-----選擇器部分-----*/\n// order區塊\nconst orderPageSection = document.querySelector('.orderPage-list');\n\n// order清單區塊\nconst orderPageTable = document.querySelector('.orderPage-table');\n\n// order狀態\nconst orderStatus = document.querySelector('.orderStatus');\n\n// 清除全部訂單btn\nconst discardAllBtn = document.querySelector('.discardAllBtn');\n\n\n/*----- 監聽部分-----*/\n\n// 改變訂單狀態\norderPageTable.addEventListener('click', e => {\n  e.preventDefault();\n  if (e.target.tagName !== 'A') return;\n  let { id, paid } = e.target.dataset;\n  let putData = {\n    \"data\": {\n      \"id\": id,\n      \"paid\": paid === 'true' ? false : true,\n    },\n  };\n  changeOrder(putData); \n});\n\n// 刪除單項訂單\norderPageTable.addEventListener('click', e => {\n  if (e.target.value !== '刪除') return;\n  const { id } = e.target.dataset;\n  deleteOrder(id);\n});\n\n// 清除全部訂單\ndiscardAllBtn.addEventListener('click', e => {\n  if (e.target.textContent !== '清除全部訂單') return;\n  deleteAllOrder();\n});\n\n/*----- 渲染部分-----*/\n\n// 訂單渲染\nfunction renderOrder(orders) {\n  const thead = `\n  <thead>\n    <tr>\n      <th>訂單編號</th>\n      <th>聯絡人</th>\n      <th>聯絡地址</th>\n      <th>電子郵件</th>\n      <th>訂單品項</th>\n      <th>訂單日期</th>\n      <th>訂單狀態</th>\n      <th>操作</th>\n    </tr>\n  </thead>`;\n  let tbody = ``;\n  orders.forEach(({ user, paid, id, products, createdAt } = item) => {\n    const {name, tel, address, email} = user;\n    tbody += `\n      <tr>\n        <td>${ createdAt }</td>\n        <td>\n          <p>${ name }</p>\n          <p>${ tel }</p>\n        </td>\n        <td>${ address }</td>\n        <td>${ email }</td>\n        <td>\n          ${ takeoutOrderItem(products) }\n        </td>\n        <td>${ convertDate(createdAt) }</td>\n        <td class=\"orderStatus\">\n          <a href=\"#\" data-id=\"${id}\" data-paid=\"${paid}\" style=\"color:${paid ? 'green' : 'red'}\">${paid ? '已處理' : '未處理'}</a>\n        </td>\n        <td>\n          <input type=\"button\" class=\"delSingleOrder-Btn\" value=\"刪除\"  data-id=\"${id}\">\n        </td>\n      </tr>`;\n\t});\n  orders.length ? \n  orderPageTable.innerHTML = thead + tbody : orderPageSection.innerHTML = `<h1 style=\"font-size:32px; text-align:center\">目前後台無訂單</h1>`;\n  \n}\n\n/*----- 其他部分-----*/\n\n// 轉換日期\nfunction convertDate(code) {\n\tconst time = new Date(code * 1000);\n\tlet months = \"1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月\".split(\",\");\n\tlet weekdays = \"星期日,星期一,星期二,星期三,星期四,星期五,星期六\".split(\",\");\n\treturn `${time.getFullYear()}年/${months[time.getMonth()]}/${time.getDate()}/${weekdays[time.getDay()]}`;\n};\n\n// 訂單品項\nfunction takeoutOrderItem(products) {\n  let titleStr = ``;\n  for (const item of products) {\n    titleStr += `<p>${item.title} / 數量:${item.quantity}</p>`;\n  };\n  return titleStr;\n};\n\n// 建立c3圖表需要的資料\nfunction createChartData(data) {\n  let saleItem = {};\n  let chartData = {\n    color: {},\n    data: [],\n  };\n  let otherAcc = 0;\n  // 將購物車所有品項列出，並計算數量，放置在物件saleItem\n  data.forEach(({ products } = item) => {\n    products.forEach(({title, quantity} = item) => {\n      if (saleItem[title] === undefined) {\n        saleItem[title] = quantity;\n      } else {\n        saleItem[title] += quantity;\n      };\n    });\n  });\n  // 將物件saleItem的屬性、值，轉為陣列\n  Object.keys(saleItem).forEach(item => {\n    let ary = [];\n    ary[0] = item;\n    ary[1] = saleItem[item];\n    chartData.data.push(ary);\n  });\n  // 依照陣列chartData.data的item[1]去排列順序由大到小\n  chartData.data.sort((a, b) => {\n    // 由大到小排列\n    return b[1] - a[1];\n  });\n  // 把chartData.data index[3]含以後的值累加起來，再push回chartData.data\n  chartData.data.forEach((item, index) => {\n    index >= 3 ? otherAcc += item[1] : '';\n  });\n  chartData.data.push(['其他', otherAcc]);\n  // 只取前三位和最後一位的資料（保留chartData.data的index[0]~index[2]還有index[chartData.data.length]）\n  // chartData.data的index[3]~index[chartData.data.length - 4]刪除\n  chartData.data.splice(3, chartData.data.length - 4);\n  // 圖表顏色\n  chartData.data.forEach((item, index) => {\n    index === 0 ? chartData.color[item[0]] = '#5151D3' : index === 1 ? chartData.color[item[0]] = '#26C0C7' : index === 2 ? chartData.color[item[0]] = '#E68618' : index === 3 ? chartData.color[item[0]] = '#E6b618' : ``;\n  });\n  chartData.chartTitle = '全品項營收比重';\n  renderC3(chartData);\n};\n\n// 渲染C3圖表\nfunction renderC3(c3Data) {\n  // 解構賦值\n  const { data, color, chartTitle } = c3Data;\n  let chart = c3.generate({\n    bindto: '#chart',\n    data: {\n      type: 'donut',\n      columns: data,\n      colors: color,\n    },\n    donut: {\n      title: chartTitle,\n    },\n  });\n}\n\n/*----- API部分-----*/\n\n// API資訊\nconst api = {\n\taddress: 'https://livejs-api.hexschool.io/api/livejs/v1',\n\tapiPath: 'ron812',\n\ttoken: 'cFphZ0CBhIMnEIvowFRtlwNKvso1',\n};\n\n// 改變訂單狀態\nfunction changeOrder(obj) {\n  const { address, apiPath } = api;\n  axios.put(`${address}/admin/${apiPath}/orders`, obj)\n    .then((res) => {\n      const { orders } = res.data;\n      renderOrder(orders);\n      jumpAlert('已更改訂單狀態', 'success');\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n};\n\n\n// 刪除單項訂單\nfunction deleteOrder(id) {\n  const { address, apiPath } = api;\n  axios.delete(`${address}/admin/${apiPath}/orders/${id}`)\n    .then((res) => {\n      const { orders } = res.data;\n      renderOrder(orders);\n      createChartData(orders);\n      jumpAlert('已刪除訂單', 'warning');\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n};\n\n\n// 刪除全部訂單\nfunction deleteAllOrder() {\n  const { address, apiPath } = api;\n  axios.delete(`${address}/admin/${apiPath}/orders`)\n    .then((res) => {\n      const { orders, message } = res.data;\n      renderOrder(orders);\n      createChartData(orders);\n      jumpAlert(message, 'warning');\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n};\n\n// init\n(async () => {\n\tconst { address, apiPath, token } = api;\n\ttry {\n\t\taxios.defaults.headers.common['Authorization'] = token;\n\t\tconst getOrders = await axios.get(`${address}/admin/${apiPath}/orders`);\n\t\tconst { data:{orders} } = getOrders;\n    console.log(orders);\n    data = orders;\n    createChartData(orders);\n    renderOrder(orders);\n\t} catch (error) {\n    console.log(error);\n\t};\n})();\n"],"mappings":"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"}